paths:  
  organizations-{organizationId}-projects-{projectId}-backups:
    get:
      tags:
        - backups
      description: |
        List backups
      operationId: list_backups
      security:
        - token: []
      parameters:
        - name: organizationId
          in: path
          required: true
          description: The id of the organization the backup is owned by
          schema:
            type: string
            format: OrganizationId
        - name: projectId
          in: path
          required: true
          description: The id of the project the backup is grouped under
          schema:
            type: string
            format: ProjectId
      responses:
        '200':
          description: returns a list of backups
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListBackupsResponse'
        '404':
          description: project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        default:
          description: unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
    post:  
      tags:
        - backups
      description: |
        Creates a new backup
      operationId: create_backup
      security:
        - token: []
      parameters:
        - name: organizationId
          in: path
          required: true
          description: The id of the organization the backup is owned by
          schema:
            type: string
            format: OrganizationId
        - name: projectId
          in: path
          required: true
          description: The id of the project the backup is grouped under
          schema:
            type: string
            format: ProjectId
      requestBody:
        description: describes a new backup
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBackupRequest'
      responses:
        '200':
          description: returns a list of backups
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateBackupResponse'
        '400':
          description: bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '404':
          description: resource not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '409':
          description: cannot create due to conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        default:
          description: unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'    
  organizations-{organizationId}-projects-{projectId}-backups-{backupId}:
    delete:
      tags:
        - backups
      description: |
        deletes a backup
      operationId: delete_backup
      security:
        - token: []
      parameters:
        - name: organizationId
          in: path
          required: true
          description: The id of the organization the backup is owned by
          schema:
            type: string
            format: OrganizationId
        - name: projectId
          in: path
          required: true
          description: The id of the project the backup is grouped under
          schema:
            type: string
            format: ProjectId
        - name: backupId
          in: path
          required: true
          description: The id of the backup to retrieve
          schema:
            type: string
            format: BackupId
      responses:
        '200':
          description: backup deleted
        '404':
          description: project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '409':
          description: cannot delete due to conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        default:
          description: unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
    get:
      tags:
        - backups
      description: |
        get a single backup
      operationId: get_backup
      security:
        - token: []
      parameters:
        - name: organizationId
          in: path
          required: true
          description: The id of the organization the backup is owned by
          schema:
            type: string
            format: OrganizationId
        - name: projectId
          in: path
          required: true
          description: The id of the project the backup is grouped under
          schema:
            type: string
            format: ProjectId
        - name: backupId
          in: path
          required: true
          description: The id of the backup to retrieve
          schema:
            type: string
            format: BackupId
      responses:
        '200':
          description: returns a backup
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetBackupResponse'
        '404':
          description: project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        default:
          description: unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'

components:  
  schemas:   
    Backup:
      type: object
      required:
        - created
        - description
        - id
        - projectId
        - provider
        - region
        - serverVersion
        - serverVersionTag
        - sizeGb
        - sourceClusterId
        - sourceClusterDescription
        - status
      properties:
        created:
          type: string
        description:
          type: string
        linkedResource:
          type: string          
        id:
          type: string
          format: BackupId
        projectId:
          type: string
          format: ProjectId
        provider:
          type: string
        region:
          type: string
        serverVersion:
          type: string
        serverVersionTag:
          type: string
        sizeGb:
          type: integer
          format: int32
        sourceClusterId:
          type: string
          format: ClusterId
        sourceClusterDescription:
          type: string
        status:
          type: string
    
    CreateBackupRequest:
      type: object
      required: 
        - description
        - sourceClusterId
      properties:
        description:
          type: string
        sourceClusterId:
          type: string
          format: ClusterId
    
    CreateBackupResponse:
      type: object
      required: 
        - id
      properties:
        id:
          type: string
          format: BackupId

    GetBackupResponse:
      type: object
      required: 
        - backup
      properties:
        backup:
          $ref: '#/components/schemas/Backup'

    ListBackupsResponse:
      type: object
      required:
        - backups
      properties:
        backups:
          type: array
          items: 
            $ref: '#/components/schemas/Backup'

    ProblemDetails:
      $ref: '../common/ProblemDetails.yaml#/components/schemas/ProblemDetails'